<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>115年(2026) 自主都更全案管理與系統開發時程表</title>
    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
      mermaid.initialize({
        startOnLoad: false,
        theme: "default",
      });
      window.mermaid = mermaid;
    </script>
    <style>
      body {
        font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
        margin: 24px;
        color: #111;
      }
      h1,
      h2 {
        margin: 0 0 12px;
      }
      .meta {
        margin-bottom: 16px;
      }
      .section {
        margin-top: 28px;
      }
      .mermaid {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        overflow-x: auto;
      }
      .mermaid svg .axis-clone text {
        fill: #334155;
        font-size: 12px;
      }
      .mermaid svg .month-line {
        stroke: #0f172a;
        stroke-width: 3px;
        opacity: 0.85;
      }
      .mermaid svg .week-line {
        stroke: #111827;
        stroke-width: 1px;
        opacity: 0.9;
      }
      .mermaid svg .day-line {
        stroke: #e5e7eb;
        stroke-width: 1px;
        opacity: 0.8;
      }
      .mermaid svg .axis-label {
        fill: #334155;
        font-size: 12px;
      }
      .mermaid svg {
        width: 100%;
        height: auto;
        min-width: 1200px;
      }
      .editor {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
        background: #f8fafc;
      }
      .editor textarea {
        width: 100%;
        min-height: 220px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        font-size: 13px;
        line-height: 1.5;
        padding: 12px;
        border-radius: 6px;
        border: 1px solid #cbd5f5;
        background: #fff;
      }
      .editor button {
        margin-top: 12px;
        padding: 8px 14px;
        border-radius: 6px;
        border: none;
        background: #2563eb;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
      .editor button:hover {
        background: #1d4ed8;
      }
    </style>
  </head>
  <body>
    <h1>115年(2026) 自主都更全案管理與系統開發時程表</h1>
    <div class="meta">
      <div><strong>目標：</strong>115年6月26日 掛件報核 (事權併送)</div>
      <div><strong>說明：</strong>此頁面可直接渲染 Mermaid 圖表，方便修改日期或節點。</div>
    </div>

    <section class="section">
      <h2>編輯甘特圖</h2>
      <div class="editor">
        <p>修改下方內容後按「更新甘特圖」即可重新渲染。</p>
        <textarea id="gantt-input"></textarea>
        <button type="button" id="render-gantt">更新甘特圖</button>
      </div>
    </section>

    <section class="section">
      <h2>甘特圖（Gantt）</h2>
      <pre class="mermaid">
%% 2026 年為民國 115 年
gantt
    title 115年(2026) 自主都更全案管理與系統開發時程表
    dateFormat  YYYY-MM-DD
    axisFormat  %m/%d
    tickInterval 1day

    section 第一階段：溝通、決策與春節模擬
    1/6~1/14 系統基礎建設      :active, 2026-01-06, 2026-01-14
    1/15~1/20 團隊工作會議     :        2026-01-15, 2026-01-20
    1/20~1/31 1F 店面拜訪      :        2026-01-20, 2026-01-31
    2/1 理事會（會前會）       :milestone, crit, 2026-02-01, 1d
    2/2~2/7 模擬系統衝刺       :        2026-02-02, 2026-02-07
    2/8 會員大會 1（議決）     :milestone, active, 2026-02-08, 1d
    2/9~2/12 選配數據建置       :        2026-02-09, 2026-02-12
    2/13~2/22 農曆春節（停工/模擬）:crit,   2026-02-13, 2026-02-22
    2/23~2/28 數據分析 & 擬稿    :        2026-02-23, 2026-02-28

    section 第二階段：事業計畫確認與公聽會
    3/1 寄發大會通知（T-15）  :milestone, 2026-03-01, 1d
    3/1~3/14 正式估價匯入      :        2026-03-01, 2026-03-14
    3/15 會員大會 2（議決）    :milestone, active, 2026-03-15, 1d
    3/19 寄發公聽會通知（T-10）:milestone, 2026-03-19, 1d
    3/29 自辦公聽會/選配說明會 :milestone, 2026-03-29, 1d
    3/30~3/31 意見整理         :        2026-03-30, 2026-03-31

    section 第三階段：選配、抽籤與最終定案
    4/1 選配開始             :milestone, 2026-04-01, 1d
    4/1~5/5 選配期間（35天）  :        2026-04-01, 2026-05-05
    5/5 選配截止             :milestone, 2026-05-05, 1d
    5/6~5/7 寄發抽籤通知       :        2026-05-06, 2026-05-07
    5/17 公開抽籤會          :milestone, 2026-05-17, 1d
    5/18~5/23 權變計畫製作     :        2026-05-18, 2026-05-23
    5/24 會員大會 3（議決）    :milestone, active, 2026-05-24, 1d

    section 第四階段：報核衝刺
    6/1~6/25 文書作業期       :        2026-06-01, 2026-06-25
    6/26 正式掛件報核         :milestone, 2026-06-26, 1d

      </pre>
    </section>

    <script type="module">
      const formatMonthDay = (date) =>
        `${String(date.getMonth() + 1).padStart(2, "0")}/${String(date.getDate()).padStart(2, "0")}`;

      const enhanceGantt = (ganttSvg) => {
        if (!ganttSvg || ganttSvg.dataset.enhanced === "true") return;

        const ticks = Array.from(ganttSvg.querySelectorAll("g.tick"));
        if (!ticks.length) return;


        const getTranslate = (transform) => {
          if (!transform) return { x: 0, y: 0 };
          const match = /translate\\(([^,]+),\\s*([^\\)]+)\\)/.exec(transform);
          return match ? { x: parseFloat(match[1]), y: parseFloat(match[2]) } : { x: 0, y: 0 };
        };

        const bbox = ganttSvg.getBBox();
        const extraTop = 30;
        const extraBottom = 28;
        const viewBox = ganttSvg.getAttribute("viewBox");
        if (viewBox) {
          const [x, y, width, height] = viewBox.split(" ").map(Number);
          if (!Number.isNaN(height)) {
            ganttSvg.setAttribute(
              "viewBox",
              `${x} ${y - extraTop} ${width} ${height + extraTop + extraBottom}`
            );
          }
        }
        const tickPositions = ticks.map((tick) => {
          const text = tick.querySelector("text")?.textContent?.trim() ?? "";
          const transform = tick.getAttribute("transform") ?? "translate(0,0)";
          const { x, y } = getTranslate(transform);
          return { tick, text, x, y, transform };
        });

        ganttSvg.dataset.enhanced = "true";

        ganttSvg.querySelectorAll("g.tick text").forEach((text) => {
          text.style.display = "none";
        });

        const gridGroup = ganttSvg.querySelector("g.grid") ?? ganttSvg;
        const year = 2026;
        const toDate = (label) => {
          const parts = label.split("/");
          if (parts.length !== 2) return null;
          const month = Number.parseInt(parts[0], 10);
          const day = Number.parseInt(parts[1], 10);
          if (Number.isNaN(month) || Number.isNaN(day)) return null;
          return new Date(year, month - 1, day);
        };

        const dates = tickPositions.map(({ text }) => toDate(text)).filter(Boolean);
        if (dates.length >= 2) {
          const labelGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
          labelGroup.setAttribute("class", "axis-labels");
          ganttSvg.appendChild(labelGroup);

          const dateToX = new Map();
          tickPositions.forEach(({ text, x }) => {
            const date = toDate(text);
            if (!date) return;
            const key = date.toISOString().slice(0, 10);
            dateToX.set(key, x);

            const dayLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            dayLine.setAttribute("x1", x);
            dayLine.setAttribute("x2", x);
            dayLine.setAttribute("y1", 0);
            dayLine.setAttribute("y2", bbox.height);
            dayLine.classList.add("day-line");
            gridGroup.appendChild(dayLine);
          });

          const minDate = new Date(Math.min(...dates.map((d) => d.getTime())));
          const maxDate = new Date(Math.max(...dates.map((d) => d.getTime())));
          const labelDates = new Map();
          const addLabelDate = (date) => {
            const key = date.toISOString().slice(0, 10);
            labelDates.set(key, date);
          };

          for (let d = new Date(minDate); d <= maxDate; d.setDate(d.getDate() + 7)) {
            addLabelDate(new Date(d));
          }
          for (
            let m = new Date(minDate.getFullYear(), minDate.getMonth(), 1);
            m <= maxDate;
            m = new Date(m.getFullYear(), m.getMonth() + 1, 1)
          ) {
            addLabelDate(new Date(m));
          }

          Array.from(labelDates.values())
            .sort((a, b) => a - b)
            .forEach((date) => {
              const key = date.toISOString().slice(0, 10);
              const x = dateToX.get(key);
              if (x === undefined) return;

              const weekLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
              weekLine.setAttribute("x1", x);
              weekLine.setAttribute("x2", x);
              weekLine.setAttribute("y1", 0);
              weekLine.setAttribute("y2", bbox.height);
              weekLine.classList.add("week-line");
              gridGroup.appendChild(weekLine);

              const labelTick = document.createElementNS("http://www.w3.org/2000/svg", "g");
              labelTick.setAttribute("transform", `translate(${x},0)`);
              labelGroup.appendChild(labelTick);

              const labelText = formatMonthDay(date);
              const topLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
              topLabel.setAttribute("x", "0");
              topLabel.setAttribute("y", "24");
              topLabel.setAttribute("text-anchor", "start");
              topLabel.setAttribute("class", "axis-label");
              topLabel.textContent = ` ${labelText}`;
              labelTick.appendChild(topLabel);

              const bottomLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
              bottomLabel.setAttribute("x", "0");
              bottomLabel.setAttribute("y", `${bbox.height + 22}`);
              bottomLabel.setAttribute("text-anchor", "start");
              bottomLabel.setAttribute("class", "axis-label");
              bottomLabel.textContent = ` ${labelText}`;
              labelTick.appendChild(bottomLabel);

              if (date.getDate() === 1) {
                const monthLine = weekLine.cloneNode(true);
                monthLine.classList.remove("week-line");
                monthLine.classList.add("month-line");
                gridGroup.appendChild(monthLine);
              }
            });
        }

        const emphasizeMeetings = () => {
          const meetingTargets = [
            { keyword: "理事會", fill: "#f97316", stroke: "#c2410c" },
            { keyword: "會員大會", fill: "#ef4444", stroke: "#b91c1c" },
            { keyword: "公聽會", fill: "#fb923c", stroke: "#ea580c" },
          ];

          const labelNodes = Array.from(ganttSvg.querySelectorAll("text"));
          labelNodes.forEach((label) => {
            const text = label.textContent?.trim() ?? "";
            const match = meetingTargets.find((target) => text.includes(target.keyword));
            if (!match) return;
            let node = label.parentElement;
            while (node && node.tagName !== "svg") {
              const rect = node.querySelector("rect");
              if (rect) {
                rect.setAttribute("fill", match.fill);
                rect.setAttribute("stroke", match.stroke);
                rect.setAttribute("stroke-width", "2");
                break;
              }
              node = node.parentElement;
            }
          });
        };

        emphasizeMeetings();
      };

      const renderGantt = async () => {
        const input = document.querySelector("#gantt-input");
        const pre = document.querySelector(".mermaid");
        if (!input || !pre || !window.mermaid) return;
        const source = input.value.trim();
        const { svg, bindFunctions } = await window.mermaid.render(
          `gantt-${Date.now()}`,
          source
        );
        pre.innerHTML = svg;
        if (bindFunctions) bindFunctions(pre);
        const svgEl = pre.querySelector("svg");
        if (svgEl) {
          svgEl.dataset.enhanced = "false";
          requestAnimationFrame(() => enhanceGantt(svgEl));
        }
      };

      window.addEventListener("load", () => {
        const input = document.querySelector("#gantt-input");
        const pre = document.querySelector(".mermaid");
        if (input && pre) {
          input.value = pre.textContent.trim();
        }
        document.querySelector("#render-gantt")?.addEventListener("click", renderGantt);
        renderGantt();
      });
    </script>
  </body>
</html>
